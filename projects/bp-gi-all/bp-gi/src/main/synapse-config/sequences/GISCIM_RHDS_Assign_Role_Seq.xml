<?xml version="1.0" encoding="UTF-8"?>
<sequence name="GISCIM_RHDS_Assign_Role_Seq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log description="seq" level="custom">
        <property name="Seq" value="---------- GISCIM_RHDS_Assign_Role_Seq ---------- "/>
    </log>
    <property description="fullRoleName" expression="fn:concat($ctx:aplicacion, '/', $ctx:role)" name="fullRoleName" scope="default" type="STRING"/>
    <log description="seq" level="custom">
        <property expression="$ctx:role" name="role"/>
        <property expression="$ctx:fullRoleName" name="fullRoleName"/>
        <property expression="get-property('cgi-error-mensaje')" name="cgi-error-mensaje"/>
        <property expression="get-property('scimResponse')" name="scimResponse"/>
    </log>
    <payloadFactory description="updateRoleListOfUser" media-type="xml">
        <format>
            <soapenv:Envelope xmlns:ser="http://service.ws.um.carbon.wso2.org" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
                <soapenv:Header>
                    <m:UserName soapenv:mustUnderstand="0" xmlns:m="http://mutualssl.carbon.wso2.org">$1</m:UserName>
                </soapenv:Header>
                <soapenv:Body>
                    <ser:updateRoleListOfUser>
                        <ser:userName>$2</ser:userName>
                        $4
                        <ser:newRoles>$3</ser:newRoles>
                    </ser:updateRoleListOfUser>
                </soapenv:Body>
            </soapenv:Envelope>
        </format>
        <args>
            <arg evaluator="xml" expression="get-property('IS_SCIM_USER')" xmlns:ns="http://org.apache.synapse/xsd"/>
            <arg evaluator="xml" expression="get-property('fullUserName')" xmlns:ns="http://org.apache.synapse/xsd"/>
            <arg evaluator="xml" expression="get-property('fullRoleName')" xmlns:ns="http://org.apache.synapse/xsd"/>
            <arg evaluator="xml" expression="$ctx:rolesToRemove//ser:deletedRoles" xmlns:ns="http://org.apache.synapse/xsd" xmlns:ser="http://service.ws.um.carbon.wso2.org"/>
        </args>
    </payloadFactory>
    <header name="SOAPAction" scope="transport" value="urn:updateRoleListOfUser"/>
    <property description="HTTP_METHOD:POST" name="HTTP_METHOD" scope="axis2" type="STRING" value="POST"/>
    <property description="uri.var.host" expression="fn:concat(get-property('IDENTITY_SERVER_HOST'), '/services/RemoteUserStoreManagerService')" name="uri.var.host" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <log description="Request Payload" level="custom">
        <property expression="get-property('uri.var.host')" name="uri.var.host"/>
        <property expression="$body/*" name="payload"/>
    </log>
    <property description="messageType" name="messageType" scope="axis2" type="STRING" value="text/xml"/>
    <property description="ContentType" name="ContentType" scope="axis2" type="STRING" value="text/xml"/>
    <call>
        <endpoint key="GIRHDS_IS_EP"/>
    </call>
    <log level="full"/>
    <property description="HTTP_SC:200" name="HTTP_SC" scope="axis2" type="STRING" value="200"/>
</sequence>
