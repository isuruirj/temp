<?xml version="1.0" encoding="UTF-8"?>
<sequence name="ProvisioningCreateTicketErrorSeq" onError="FaultSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log level="custom" category="DEBUG">
        <property name="ProvisioningCreateTicketErrorSeq" value="Inicio.." />
    </log>
    <property name="taskProvisioningCreate" expression="$body//*" scope="default" type="OM" />
    <sequence key="ProvisioningConfigureApplicationSeq" />
    <payloadFactory media-type="xml">
        <format>
            <tem:crearTicket xmlns:tem="http://tempuri.org/">
                <!--Common-->
                <tem:guid>$1</tem:guid>
                <tem:uuid>$2</tem:uuid>
                <tem:aplicacion>$3</tem:aplicacion>
                <tem:correoElectronico>$4</tem:correoElectronico>
                <tem:tellerName>$5</tem:tellerName>
                <tem:tellerNumber>$6</tem:tellerNumber>
                <tem:nombreUsuario>$7</tem:nombreUsuario>
                <tem:tipoIdentificacion>$8</tem:tipoIdentificacion>
                <tem:empresa>$9</tem:empresa>
                <tem:observacion>$10</tem:observacion>
                <tem:cargo>$11</tem:cargo>
                <tem:cargoCompleto>$12</tem:cargoCompleto>
                <tem:codigoCentroCosto>$13</tem:codigoCentroCosto>
                <tem:identificacion>$14</tem:identificacion>
                <tem:celular>$15</tem:celular>
                <tem:terminal>$16</tem:terminal>
                <tem:nombresEmpleado>$17</tem:nombresEmpleado>
                <tem:apellidosEmpleado>$18</tem:apellidosEmpleado>
                <tem:codigoCompania>$19</tem:codigoCompania>
                <tem:fechaSalidaEmpleado>$20</tem:fechaSalidaEmpleado>
                <tem:fechaIngresoEmpleado>$21</tem:fechaIngresoEmpleado>
                <tem:nombreCompania>$22</tem:nombreCompania>
                <tem:nombreDivision>$23</tem:nombreDivision>
                <tem:nombreArea>$24</tem:nombreArea>
                <tem:nombreDepartamento>$25</tem:nombreDepartamento>
                <tem:nombrePerfil>$26</tem:nombrePerfil>
                <tem:nombreCentroCosto>$27</tem:nombreCentroCosto>
                <tem:estadoEmpleado>$28</tem:estadoEmpleado>
                <tem:claveAcceso>$29</tem:claveAcceso>
                <tem:ipcliente>$30</tem:ipcliente>
                <tem:usuarioAplicacion>$31</tem:usuarioAplicacion>
                <tem:domain>$32</tem:domain>
                <tem:ERROR>$33</tem:ERROR>
            </tem:crearTicket>
        </format>
        <args>
            <!-- C O M M O N S -->
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/guid/text()" />
            <arg evaluator="xml" expression="$ctx:taskProvisioningCreate//uuid/text()" />
            <arg evaluator="xml" expression="$ctx:application//applicationList/application/applicationGroup/code/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/mail/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/username/text()" />
            <arg evaluator="xml" expression="$ctx:restUserStoreScim//tellerNumber/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/username/text()" />
            <arg evaluator="xml" expression="$ctx:idetificationType" />
            <arg evaluator="xml" value="0010" />
            <arg evaluator="xml" value="AUTO - PROVISIONADO DESDE GI" />
            <arg evaluator="xml" expression="fn:substring($ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/positionName/text(),1,13)" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/positionName/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/costCenterCode/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/identification/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/mobile/text()" />
            <arg evaluator="xml" expression="get-property('SERVER_IP')" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/employeeFirstname/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/employeeLastname/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/companyCode/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/employeeEndDate/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/employeeStartDate/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/companyName/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/divisionName/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/areaName/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/departmentName/text()" />
            <arg evaluator="xml" expression="fn:concat($ctx:transactionalProfile//code/text(),' : ',$ctx:transactionalProfile//name/text())" />
            <arg evaluator="xml" expression="fn:concat($ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/costCenterCode/text(),' ',$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/costCenterName/text())" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/employeeStatus/text()" />
            <arg evaluator="xml" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/password/text()" />
            <arg evaluator="xml" expression="$ctx:X-Forwarded-For" />
            <arg evaluator="xml" expression="$ctx:UserName" />
            <arg evaluator="xml" expression="$ctx:costCenter//company/domainName" />
            <arg evaluator="xml" value="Aplicacion no pudo ser aprovisionada, ya que ocurrio un error al provisionar BANCS" />
        </args>
    </payloadFactory>
    <property name="target.endpoint" value="ProvisioningEP" />
    <header name="Action" value="http://tempuri.org/crearTicket" />
    <property name="SOAPAction" scope="transport" value="http://tempuri.org/crearTicket" />
    <store messageStore="ProvisioningStore" />
    <!-- actualizar xml -->
    <property name="input" expression="$body/*[1]" scope="default" />
    <property name="uuid" expression="ctx:taskProvisioningCreate//uuid/text()" />
    <call-template target="UpdateDataInputTemplate">
        <with-param name="type" value="Q" />
        <with-param name="input" value="{get-property('input')}" />
        <with-param name="uuid" value="{get-property('uuid')}" />
    </call-template>
    <log level="custom" category="DEBUG">
        <property name="ProvisioningCreateTicketErrorSeq" value="Fin.." />
    </log>
</sequence>