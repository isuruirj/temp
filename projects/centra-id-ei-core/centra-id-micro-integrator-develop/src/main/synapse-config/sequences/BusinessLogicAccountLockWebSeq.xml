<?xml version="1.0" encoding="UTF-8"?>
<sequence name="BusinessLogicAccountLockWebSeq" onError="FaultSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse" xmlns:ns="http://org.apache.synapse/xsd">
    <log level="custom" category="DEBUG">
        <property name="BusinessLogicAccountLockWebSeq" value="Inicio..." />
        <property name="username" expression="//username" />
    </log>
    <!-- Bloquear Usuario -->
    <payloadFactory media-type="xml">
        <format>
            <ser:setUserClaimValues xmlns:ser="http://service.ws.um.carbon.wso2.org" xmlns:xsd="http://common.mgt.user.carbon.wso2.org/xsd">
                <ser:userName>$1</ser:userName>
                <ser:claims>
                    <xsd:claimURI>http://wso2.org/claims/identity/accountLocked</xsd:claimURI>
                    <xsd:value>true</xsd:value>
                </ser:claims>
                <ser:profileName>default</ser:profileName>
            </ser:setUserClaimValues>
        </format>
        <args>
            <arg evaluator="xml" expression="//username" />
        </args>
    </payloadFactory>
    <property xmlns:ns2="http://org.apache.synapse/xsd" xmlns:ns="http://org.apache.synapse/xsd" name="IS_SERVER_USER_DATO" expression="synapse:get-property('IS_SERVER_USER')" scope="default" />
    <property xmlns:ns2="http://org.apache.synapse/xsd" xmlns:ns="http://org.apache.synapse/xsd" name="IS_SERVER_PASSWORD_DATO" expression="synapse:get-property('IS_SERVER_PASSWORD')" scope="default" />
    <property xmlns:ns="http://org.apache.synapse/xsd" name="Authorization" expression="fn:concat('Basic ', base64Encode(fn:concat($ctx:IS_SERVER_USER_DATO,':',$ctx:IS_SERVER_PASSWORD_DATO)))" scope="transport" />
    <property name="service_ep" expression="fn:concat(get-property('uri.var.identityServerHost'),'/services' ,'/RemoteUserStoreManagerService')" />
    <header name="To" expression="get-property('service_ep')" />
    <log level="custom" category="INFO" separator="**1**">
        <property name="sp" expression="get-property('service_ep')" />
    </log>
    <property name="Accept" scope="transport" value="application/xml" />
    <call>
        <endpoint>
            <default />
        </endpoint>
    </call>
    <log level="custom" category="INFO" separator="**2**"></log>
    <property name="fault" expression="//ns:UserStoreException" />
    <property name="fault2" expression="//faultstring" />
    <log level="custom" separator="**3**">
        <property name="fault" expression="get-property('fault')" />
        <property name="fault2" expression="get-property('fault2')" />
    </log>
    <filter regex="true" source="boolean(get-property('fault')) or boolean(get-property('fault2'))">
        <then>
            <property name="fault" expression="fn:concat(get-property('fault'),':',get-property('fault2'))" />
            <sequence key="FaultSeq" />
        </then>
    </filter>
    <property name="messageType" scope="axis2" type="STRING" value="application/json" />
    <property name="HTTP_SC" scope="axis2" type="STRING" value="200" />
    <payloadFactory media-type="json">
        <format>
            {
                "result":  {
                    "code" : 0,
                    "message" : "Operation performed successfully"
                }
            }
        </format>
        <args></args>
    </payloadFactory>
    <log level="custom" category="DEBUG">
        <property name="BusinessLogicAccountLockWebSeq" value="Fin..." />
    </log>
</sequence>