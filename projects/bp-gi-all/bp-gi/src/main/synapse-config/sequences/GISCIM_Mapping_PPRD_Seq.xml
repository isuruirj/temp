<?xml version="1.0" encoding="UTF-8"?>
<sequence name="GISCIM_Mapping_PPRD_Seq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log description="seq" level="custom">
        <property name="seq" value="-------------------- GISCIM_Mapping_PPRD_Seq --------------------"/>
    </log>
    <property description="tellerName" expression="$body/*/tem:tellerName/text()" name="tellerName" scope="default" type="STRING" xmlns:tem="http://tempuri.org/"/>
    <!-- <script description="Validate #tellerName" language="js"><![CDATA[adjustTellername();
    
    function adjustTellername() {
    var log = mc.getServiceLog();
    var tellerName = mc.getProperty('tellerName');
	
	
    if (tellerName != null && tellerName.length() < 8) {
    	log.info("................ Length adjustment is necessary.Current length:" + tellerName.length());
        var rem = 8 - tellerName.length();
        for (var i = 0; i < rem; i++) {
            tellerName = tellerName + " ";
        }
        mc.setProperty("tellerName", tellerName.toString());
    }  
}]]></script> -->
	<filter xpath="string-length($ctx:tellerName) &lt; 8" regex="true">
		<then>
			<property name="tellerName" expression="substring(concat($ctx:tellerName,'        '), 1, 8)" />
		</then>
		<else/>
	</filter>
	<payloadFactory description="PPRD Payload" media-type="json">
        <format>
        		{
	"emails": [
		 {"type": "other", "value": "$1"}
	],
	"schemas": [
		"urn:ietf:params:scim:schemas:core:2.0:User",
		"urn:ietf:params:scim:schemas:extension:enterprise:2.0:User"
	],
	"EnterpriseUser" : {
        "tellerName": "$2",
        "tellerNumber" : "$3",
        "nombreUsuario": "$4",
        "tipoIdentificacion": "$5",
		"empresa": "$6",
        "observacion" : "$7",
		"cargo" : "$8",
		"centroDeCostos" : "$9",
		"identificacion": "$10",
        "celular": "$11",
        "terminal": "$12",
        "perfilUsuario": "$13",
		"loginUsuario": "$14",
		"usuarioInterno": "$15"
	},
	"name": {
		"givenName": "$16"
	},
	"userName": "$17",
	"password" : "$18"
				}
        		</format>
        <args>
            <arg evaluator="xml" expression="$body/*/tem:correoElectronico/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$ctx:tellerName" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:tellerNumber/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="fn:concat($body//*/tem:apellidosEmpleado/text(),' ', $body//*/tem:nombresEmpleado/text())" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:tipoIdentificacion/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:empresa/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:observacion/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="fn:substring($body/*/tem:cargoCompleto/text(),1,15)" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:codigoCentroCosto/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:identificacion/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:celular/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="fn:substring($body/*/tem:terminal/text(),1,10)" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:especificos/tem:perfilUsuario/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:especificos/tem:loginUsuario/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:especificos/tem:usuarioInterno/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="$body/*/tem:nombresEmpleado/text()" xmlns:tem="http://tempuri.org/"/>
            <arg evaluator="xml" expression="fn:concat(get-property('aplicacion'),'/',get-property('tellerName'))"/>
            <arg value="default"/>
        </args>
    </payloadFactory>
</sequence>
