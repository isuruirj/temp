<?xml version="1.0" encoding="UTF-8"?>
<template name="FindCatalogsSeqTemplate" xmlns="http://ws.apache.org/ns/synapse" xmlns:cen="centra-id.com">
    <parameter name="type" />
    <parameter name="subtype" />
    <parameter name="code" />
    <sequence>
        <log level="custom" separator=", ">
            <property name="FindCatalogsSeqTemplate" value="Inicio..." />
            <property name="type" expression="$func:type" />
            <property name="subtype" expression="$func:subtype" />
            <property name="code" expression="$func:code" />
        </log>
        <header action="remove" name="Content-Type" scope="transport" />
        <property action="remove" name="REST_URL_POSTFIX" scope="axis2" />
        <filter regex="true" source="boolean($func:code)">
            <then>
                <switch source="$func:type">
                    <case regex="CATALOG">
                        <property name="uri.var.code" expression="$func:code" />
                        <property name="uri.var.type" expression="$func:subtype" />
                        <call>
                            <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.dataServiceHost}/CatalogsDSS.HTTPEndpoint/getByCodeTypeCatalogAndCatalog?catalogCode={uri.var.code}&amp;typeCatalogCode={uri.var.type}" />
                        </call>
                        <log level="custom" separator=", " />
                        <property name="name" expression="//cen:name" />
                    </case>
                    <case regex="COMPANY">
                        <property name="uri.var.code" expression="$func:code" />
                        <call>
                            <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.dataServiceHost}/CompaniesDSS.HTTPEndpoint/getByCodeCompany?code={uri.var.code}" />
                        </call>
                        <log level="custom" separator=", " />
                        <property name="name" expression="//cen:businessName" />
                    </case>
                    <case regex="TYPE_USER">
                        <property name="uri.var.code" expression="$func:code" />
                        <property name="uri.var.type" expression="$func:subtype" />
                        <call>
                            <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.dataServiceHost}/TypesUsersDSS.HTTPEndpoint/getByCodeAndTypeTypesUsers?code={uri.var.code}&amp;type={uri.var.type}" />
                        </call>
                        <log level="custom" separator=", " />
                        <property name="name" expression="//cen:name" />
                    </case>
                    <case regex="COST_CENTER">
                        <property name="uri.var.centerCostCode" expression="$func:code" />
                        <property name="uri.var.companyCode" expression="$func:subtype" />
                        <call>
                            <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.dataServiceHost}/CostsCentersDSS.HTTPEndpoint/getByCompanyCodeAndCodeCostCenter?centerCostCode={uri.var.centerCostCode}&amp;companyCode={uri.var.companyCode}" />
                        </call>
                        <log level="custom" separator=", " />
                        <property name="name" expression="//cen:name" />
                    </case>
                    <case regex="GLOBAL_PROFILE">
                        <property name="uri.var.globalProfileCode" expression="$func:code" />
                        <call>
                            <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.enterpriseIntegratorHost}/api.centraid/application/GlobalProfile/0/1?code={uri.var.globalProfileCode}" />
                        </call>
                        <property name="name" expression="//globalProfileList/globalProfile/name" />
                    </case>
                    <case regex="USERDATA">
                        <property name="uri.var.employeeCode" expression="$func:code" />
                        <call>
                            <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.enterpriseIntegratorHost}/api.centraid/identity/UserDataSimple/0/1?employeeCode={uri.var.employeeCode}" />
                        </call>
                        <property name="name" expression="//employeeCompleteName" />
                    </case>
                </switch>
            </then>
            <else>
                <property name="name" value="" />
            </else>
        </filter>
        <log level="custom" separator=", ">
            <property name="FindCatalogsSeqTemplate" value="Fin..." />
            <property name="name" expression="get-property('name')" />
        </log>
    </sequence>
</template>