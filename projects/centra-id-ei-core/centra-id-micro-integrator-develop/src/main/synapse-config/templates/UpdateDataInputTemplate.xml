<?xml version="1.0" encoding="UTF-8"?>
<template name="UpdateDataInputTemplate" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="type" />
    <parameter name="input" />
    <parameter name="uuid" />
    <sequence>
        <switch source="$func:type">
            <case regex="Q">
                <property name="messageType" scope="axis2" type="STRING" value="application/xml" />
                <property name="Accept" scope="transport" type="STRING" value="application/xml" />
                <payloadFactory media-type="xml">
                    <format>
                        <ci:update_all_query_operation xmlns:ci="centra-id.com">
                            <ci:table>SCH_CENTRA_ID.TAKS_PROVISIONING</ci:table>
                            <ci:set>DATA_INPUT_QUEUE='$1'</ci:set>
                            <ci:where>VALID=1 AND UUID='$2'</ci:where>
                        </ci:update_all_query_operation>
                    </format>
                    <args>
                        <arg evaluator="xml" expression="base64Encode($func:input)" />
                        <arg evaluator="xml" expression="$func:uuid" />
                    </args>
                </payloadFactory>
            </case>
            <case regex="P">
                <property name="messageType" scope="axis2" type="STRING" value="application/xml" />
                <property name="Accept" scope="transport" type="STRING" value="application/xml" />
                <payloadFactory media-type="xml">
                    <format>
                        <ci:update_all_query_operation xmlns:ci="centra-id.com">
                            <ci:table>SCH_CENTRA_ID.TAKS_PROVISIONING</ci:table>
                            <ci:set>DATA_INPUT_PROVISIONING='$1'</ci:set>
                            <ci:where>VALID=1 AND UUID='$2'</ci:where>
                        </ci:update_all_query_operation>
                    </format>
                    <args>
                        <arg evaluator="xml" expression="base64Encode($func:input)" />
                        <arg evaluator="xml" expression="$func:uuid" />
                    </args>
                </payloadFactory>
            </case>
        </switch>
        <call>
            <endpoint template="HTTPEndpointPutTemplate" uri="{uri.var.dataServiceHost}/UsersDSS.HTTPEndpoint/updateAll" />
        </call>
    </sequence>
</template>