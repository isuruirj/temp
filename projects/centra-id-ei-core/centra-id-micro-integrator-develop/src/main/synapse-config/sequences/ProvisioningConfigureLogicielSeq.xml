<?xml version="1.0" encoding="UTF-8"?>
<sequence xmlns="http://ws.apache.org/ns/synapse" onError="FaultSeq" name="ProvisioningConfigureLogicielSeq">
    <log level="custom" category="DEBUG">
        <property name="ProvisioningConfigureLogicielSeq" value="Inicio.." />
    </log>
    <!-- selecciona campo codigo tipo de usuario -->
    <property name="logicielCodigoTipoUsuario" value="SU03" />
    <!-- selecciona campo interno -->
    <switch source="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/userType/text()">
        <case regex="PER">
            <switch source="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/userSubtype/text()">
                <case regex="EMP">
                    <property name="logicielInterno" value="1" />
                </case>
                <case regex="EXT">
                    <property name="logicielInterno" value="0" />
                </case>
            </switch>
        </case>
        <case regex="GEN">
            <property name="logicielInterno" value="1" />
        </case>
    </switch>
    <!-- selecciona campo loginSupervisor-->
    <property name="uri.var.identificationSupervisor" expression="$ctx:operationProvisioning//operationProvisioningList/operationProvisioning/transactionalIdentity/identificationSupervisor/text()" />
    <filter regex="true" source="boolean($ctx:uri.var.identificationSupervisor)">
        <then>
            <call>
                <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.enterpriseIntegratorHost}/api.centraid/identity/UserDataSimple?identification={uri.var.identificationSupervisor}" />
            </call>
            <filter regex="200" source="get-property('axis2', 'HTTP_SC')">
                <then>
                    <property name="logicielLoginSupervisor" expression="//username" />
                </then>
                <else>
                    <property name="logicielLoginSupervisor" value="" />
                </else>
            </filter>
        </then>
        <else>
            <property name="logicielLoginSupervisor" value="" />
        </else>
    </filter>
    <log level="custom" category="DEBUG">
        <property name="ProvisioningConfigureLogicielSeq" value="Fin.." />
        <property name="logicielLoginSupervisor" expression="$ctx:logicielLoginSupervisor"/>
        <property name="logicielInterno" expression="$ctx:logicielInterno"/>
        <property name="logicielCodigoTipoUsuario" expression="$ctx:logicielCodigoTipoUsuario"/>

    </log>
</sequence>