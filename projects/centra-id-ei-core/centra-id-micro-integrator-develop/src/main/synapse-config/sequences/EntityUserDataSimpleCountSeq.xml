<?xml version="1.0" encoding="UTF-8"?>
<sequence name="UserDataSimpleCountSeq" onError="FaultSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log level="custom" category="DEBUG">
        <property name="UserDataSimpleCountSeq" value="Inicio.." />
    </log>
    <property action="remove" name="REST_URL_POSTFIX" scope="axis2" />
    <property name="messageType" scope="axis2" type="STRING" value="application/json" />
    <property name="Accept" scope="transport" type="STRING" value="application/json" />
    <property action="remove" name="Content-Type" scope="transport" />
    <property expression="$ctx:query.param.id" name="id" scope="default" type="STRING" />
    <property expression="$ctx:query.param.username" name="username" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeFirstSurname" name="employeeFirstSurname" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeSecondSurname" name="employeeSecondSurname" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeFirstName" name="employeeFirstName" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeSecondName" name="employeeSecondName" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeCompleteName" name="employeeCompleteName" scope="default" type="STRING" />
    <property expression="$ctx:query.param.identification" name="identification" scope="default" type="STRING" />
    <property expression="$ctx:query.param.companyId" name="companyId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.catalogDivisionId" name="catalogDivisionId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.catalogAreaId" name="catalogAreaId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.catalogDepartmentId" name="catalogDepartmentId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.catalogPositionId" name="catalogPositionId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.groupingCode" name="groupingCode" scope="default" type="STRING" />
    <property expression="$ctx:query.param.subsidiaryCode" name="subsidiaryCode" scope="default" type="STRING" />
    <property expression="$ctx:query.param.subsidiaryName" name="subsidiaryName" scope="default" type="STRING" />
    <property expression="$ctx:query.param.costCenterId" name="costCenterId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.locationName" name="locationName" scope="default" type="STRING" />
    <property expression="$ctx:query.param.hierarchicalLevel" name="hierarchicalLevel" scope="default" type="STRING" />
    <property expression="$ctx:query.param.depositAccountNumber" name="depositAccountNumber" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeIncomeDate" name="employeeIncomeDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeDepartureDate" name="employeeDepartureDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeStatus" name="employeeStatus" scope="default" type="STRING" />
    <property expression="$ctx:query.param.employeeCode" name="employeeCode" scope="default" type="STRING" />
    <property expression="$ctx:query.param.registrationDate" name="registrationDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.guid" name="guid" scope="default" type="STRING" />
    <property expression="$ctx:query.param.typeEvent" name="typeEvent" scope="default" type="STRING" />
    <property expression="$ctx:query.param.dataDate" name="dataDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.uuid" name="uuid" scope="default" type="STRING" />
    <property expression="$ctx:query.param.provisionDate" name="provisionDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.mobile" name="mobile" scope="default" type="STRING" />
    <property expression="$ctx:query.param.suspensionStartDate" name="suspensionStartDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.suspensionEndDate" name="suspensionEndDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.suspensionReason" name="suspensionReason" scope="default" type="STRING" />
    <property expression="$ctx:query.param.suspensionType" name="suspensionType" scope="default" type="STRING" />
    <property expression="$ctx:query.param.validationStartDate" name="validationStartDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.validationEndDate" name="validationEndDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.endingWorkDate" name="endingWorkDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.catalogIdentificationTypeId" name="catalogIdentificationTypeId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.globalProfileId" name="globalProfileId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.mail" name="mail" scope="default" type="STRING" />
    <property expression="$ctx:query.param.effectiveDate" name="effectiveDate" scope="default" type="STRING" />
    <property expression="$ctx:query.param.usernameView" name="usernameView" scope="default" type="STRING" />
    <property expression="$ctx:query.param.userdataSupervisorId" name="userdataSupervisorId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.userdataResponsibleUserId" name="userdataResponsibleUserId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.userdataBankCounterpartId" name="userdataBankCounterpartId" scope="default" type="STRING" />
    <property expression="$ctx:query.param.workerCode" name="workerCode" scope="default" type="STRING" />
    <property expression="$ctx:query.param.justificationElimination" name="justificationElimination" scope="default" type="STRING" />
    <property expression="$ctx:query.param.justificationChangeCostCenter" name="justificationChangeCostCenter" scope="default" type="STRING" />
    <property expression="$ctx:query.param.justificationChangeGlobalProfile" name="justificationChangeGlobalProfile" scope="default" type="STRING" />
    <property expression="$ctx:query.param.filter" name="filter" scope="default" type="STRING" />
    <property expression="$ctx:query.param.typeRotary" name="typeRotary" scope="default" type="STRING" />
    <property expression="$ctx:query.param.counterGenericRotary" name="counterGenericRotary" scope="default" type="STRING" />
    <property expression="$ctx:query.param.counterGenericMail" name="counterGenericMail" scope="default" type="STRING" />
    <property expression="$ctx:query.param.valid" name="valid" scope="default" type="STRING" />
    <script language="nashornJs"><![CDATA[
        @add.where.js.function
        function operatorType(value) {
            if(value.indexOf("*")!=-1 ) {
                return " LIKE ";
            } else {
                return " = ";
            }
        }
        var log = mc.getServiceLog();
        var where = " WHERE userDataSimple.valid=1 ";
        var innerJoin = "";
        where += addWhere("id","Integer","userDataSimple","id");
        where += addWhere("username","String","userDataSimple","username");
        where += addWhere("employeeFirstSurname","String","userDataSimple","employee_first_surname");
        where += addWhere("employeeSecondSurname","String","userDataSimple","employee_second_surname");
        where += addWhere("employeeFirstName","String","userDataSimple","employee_first_name");
        where += addWhere("employeeSecondName","String","userDataSimple","employee_second_name");
        where += addWhere("employeeCompleteName","String","userDataSimple","employee_complete_name");
        where += addWhere("identification","String","userDataSimple","identification");
        where += addWhere("companyId","Integer","userDataSimple","company_id");
        where += addWhere("catalogDivisionId","Integer","userDataSimple","catalog_division_id");
        where += addWhere("catalogAreaId","Integer","userDataSimple","catalog_area_id");
        where += addWhere("catalogDepartmentId","Integer","userDataSimple","catalog_department_id");
        where += addWhere("catalogPositionId","Integer","userDataSimple","catalog_position_id");
        where += addWhere("groupingCode","String","userDataSimple","grouping_code");
        where += addWhere("subsidiaryCode","String","userDataSimple","subsidiary_code");
        where += addWhere("subsidiaryName","String","userDataSimple","subsidiary_name");
        where += addWhere("costCenterId","Integer","userDataSimple","cost_center_id");
        where += addWhere("locationName","String","userDataSimple","location_name");
        where += addWhere("hierarchicalLevel","String","userDataSimple","hierarchical_level");
        where += addWhere("depositAccountNumber","String","userDataSimple","deposit_account_number");
        where += addWhere("employeeIncomeDate","Date","userDataSimple","employee_income_date");
        where += addWhere("employeeDepartureDate","Date","userDataSimple","employee_departure_date");
        where += addWhere("employeeStatus","String","userDataSimple","employee_status");
        where += addWhere("employeeCode","String","userDataSimple","employee_code");
        where += addWhere("registrationDate","Date","userDataSimple","registration_date");
        where += addWhere("guid","String","userDataSimple","guid");
        where += addWhere("typeEvent","String","userDataSimple","type_event");
        where += addWhere("dataDate","Date","userDataSimple","data_date");
        where += addWhere("uuid","String","userDataSimple","uuid");
        where += addWhere("provisionDate","Date","userDataSimple","provision_date");
        where += addWhere("mobile","String","userDataSimple","mobile");
        where += addWhere("suspensionStartDate","Date","userDataSimple","suspension_start_date");
        where += addWhere("suspensionEndDate","Date","userDataSimple","suspension_end_date");
        where += addWhere("suspensionReason","String","userDataSimple","suspension_reason");
        where += addWhere("suspensionType","String","userDataSimple","suspension_type");
        where += addWhere("validationStartDate","Date","userDataSimple","validation_start_date");
        where += addWhere("validationEndDate","Date","userDataSimple","validation_end_date");
        where += addWhere("endingWorkDate","Date","userDataSimple","ending_work_date");
        where += addWhere("catalogIdentificationTypeId","Integer","userDataSimple","catalog_identification_type_id");
        where += addWhere("globalProfileId","Integer","userDataSimple","global_profile_id");
        where += addWhere("mail","String","userDataSimple","mail");
        where += addWhere("effectiveDate","Date","userDataSimple","effective_date");
        where += addWhere("usernameView","String","userDataSimple","username_view");
        where += addWhere("userdataSupervisorId","Integer","userDataSimple","userdata_supervisor_id");
        where += addWhere("userdataResponsibleUserId","Integer","userDataSimple","userdata_responsible_user_id");
        where += addWhere("userdataBankCounterpartId","Integer","userDataSimple","userdata_bank_counterpart_id");
        where += addWhere("workerCode","String","userDataSimple","worker_code");
        where += addWhere("justificationElimination","String","userDataSimple","justification_elimination");
        where += addWhere("justificationChangeCostCenter","String","userDataSimple","justification_change_cost_center");
        where += addWhere("justificationChangeGlobalProfile","String","userDataSimple","justification_change_global_profile");
        where += addWhere("filter","String","userDataSimple","filter");
        where += addWhere("typeRotary","String","userDataSimple","type_rotary");
        where += addWhere("counterGenericRotary","Integer","userDataSimple","counter_generic_rotary");
        where += addWhere("counterGenericMail","Integer","userDataSimple","counter_generic_mail");
        where += addWhere("valid","Integer","userDataSimple","valid");
        mc.setProperty("uri.var.whereclause",where);
        mc.setProperty("uri.var.innerjoinclause",innerJoin);
        log.debug(where);]]></script>

    <property value="sch_centra_id.USERDATA userDataSimple" name="uri.var.table" scope="default" type="STRING"/>
    <property value="COUNT" name="uri.var.function" scope="default" type="STRING"/>
    <property value="*" name="uri.var.field" scope="default" type="STRING"/>

    <call>
        <endpoint name="UserDataSimpleDSS_Endpoint" template="HTTPEndpointGetTemplate"
              uri="{uri.var.dataServiceHost}/identity.user-data-simple.ds.HTTPEndpoint/GetFunctionResultUserDataSimple?function={uri.var.function}&amp;whereclause={uri.var.whereclause}&amp;field={uri.var.field}&amp;table={uri.var.table}&amp;innerjoinclause={uri.var.innerjoinclause}" />

    </call>

    <property expression="json-eval($.Fault.faultcode)" name="faultCode" scope="default" type="STRING"/>
    <filter regex="true" source="boolean(get-property('faultCode'))">
        <then>
            <sequence key="FaultSeq"/>
        </then>
        <else>
            <payloadFactory media-type="json">
                <format>
                    {
                        "count": $1
                    }
                </format>
                <args>
                    <arg evaluator="json" expression="$.result.value"/>
                </args>
            </payloadFactory>
            <property name="HTTP_SC" scope="axis2" type="STRING" value="200"/>
        </else>
    </filter>
    <log level="custom" category="DEBUG">
        <property name="UserDataSimpleCountSeq" value="Fin.." />
    </log>
    <respond />
</sequence>
