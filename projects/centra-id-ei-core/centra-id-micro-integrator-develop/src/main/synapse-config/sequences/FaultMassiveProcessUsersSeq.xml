<?xml version="1.0" encoding="UTF-8"?>
<sequence name="FaultMassiveProcessUsersSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse" xmlns:axis2ns65="http://ws.wso2.org/dataservice" xmlns:cen="centra-id.com">
    <log level="custom" separator="| ">
        <property name="FaultMassiveProcessUsersSeq" value="Inicio..." />
        <property name="text" value="An unexpected error occurred" />
        <property expression="$ctx:ERROR_MESSAGE" name="message" />
        <property expression="$ctx:ERROR_CODE" name="code" />
        <property expression="$ctx:ERROR_DETAIL" name="detail" />
        <property expression="$ctx:ERROR_EXCEPTION" name="exception" />
        <property expression="get-property('observations')" name="observations" />
    </log>
    <filter regex="true" source="boolean(get-property('jsonEmployee'))">
        <then>
            <property name="jsonFault" expression="get-property('jsonEmployee')" />
        </then>
        <else>
            <property name="jsonFault" expression="get-property('json')" />
        </else>
    </filter>
    <payloadFactory media-type="json">
        <format>
			$1
		</format>
        <args>
            <arg evaluator="xml" expression="get-property('json')" xmlns:cen="centra-id.com" />
        </args>
    </payloadFactory>
    <filter regex="true" source="boolean(get-property('observations'))" xmlns:cen="centra-id.com">
        <then>
            <log level="custom" separator="| ">
                <property expression="get-property('observations')" name="observations" />
            </log>
            <payloadFactory media-type="xml">
                <format>
                    <cen:_postcreatemassiveprocessproblem>
                        <cen:guid>$1</cen:guid>
                        <cen:json>$2</cen:json>
                        <cen:observations>$3</cen:observations>
                    </cen:_postcreatemassiveprocessproblem>
                </format>
                <args>
                    <arg evaluator="xml" expression="get-property('guid')" />
                    <arg evaluator="xml" expression="get-property('jsonFault')" />
                    <arg evaluator="xml" expression="get-property('observations')" />
                </args>
            </payloadFactory>
        </then>
        <else>
            <property name="observations" expression="fn:concat($ctx:ERROR_CODE,';',$ctx:ERROR_MESSAGE,';',$ctx:ERROR_DETAIL,';',$ctx:ERROR_EXCEPTION)" />
            <payloadFactory media-type="xml">
                <format>
                    <cen:_postcreatemassiveprocessproblem>
                        <cen:guid>$1</cen:guid>
                        <cen:json>$2</cen:json>
                        <cen:observations>$3</cen:observations>
                    </cen:_postcreatemassiveprocessproblem>
                </format>
                <args>
                    <arg evaluator="xml" expression="get-property('guid')" />
                    <arg evaluator="xml" expression="get-property('jsonFault')" />
                    <arg evaluator="xml" expression="get-property('observations')" />
                </args>
            </payloadFactory>
        </else>
    </filter>
    <property action="remove" name="REST_URL_POSTFIX" scope="axis2" />
    <call>
        <endpoint name="MassiveProcessProblemDSS" template="HTTPEndpointPostTemplate" uri="{uri.var.dataServiceHost}/MassiveProcessProblemsDSS.HTTPEndpoint/createMassiveProcessProblem" />
    </call>
    <drop />
    <!--
    <property name="HTTP_SC" scope="axis2" type="STRING" value="200" />
    <property name="messageType" scope="axis2" type="STRING" value="application/json" />
    <property name="Access-Control-Allow-Origin" scope="transport" type="STRING" value="*" />
    <payloadFactory media-type="json">
        <format>
			{
			"result": "ok"
			}
		</format>
        <args />
    </payloadFactory>
    <log level="custom" separator="| ">
        <property name="FaultMassiveProcessUsersSeq" value="Fin..." />
    </log>
    <respond />
    -->
</sequence>