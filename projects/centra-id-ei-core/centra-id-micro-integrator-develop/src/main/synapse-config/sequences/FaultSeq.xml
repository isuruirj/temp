<?xml version="1.0" encoding="UTF-8"?>
<sequence name="FaultSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse" xmlns:axis2ns65="http://ws.wso2.org/dataservice">
	<property expression="$body//*" name="payload" scope="default" type="STRING" />
	<property name="exception" expression="fn:concat('FAULT: ',get-property('fault'),'ERROR_MESSAGE: ',$ctx:ERROR_MESSAGE,' ERROR_CODE: ',$ctx:ERROR_CODE,' ERROR_DETAIL: ',$ctx:ERROR_DETAIL,' ERROR_EXCEPTION: ',$ctx:ERROR_EXCEPTION,' PAYLOAD: ',get-property('payload'))" />
	<log level="custom" category="INFO">
		<property name="exception" expression="$ctx:exception"/>
	</log>
	<!-- Log error in DB -->
	<sequence key="LogExceptionSeq" />
	<payloadFactory media-type="json">
		<format>
					{
					"text":"$1",
					"guid":"$2",
					"appCalled":"$3",
					"actionCalled":"$4",
					"requestJson":"$5",
                    "exception":"$6"
					}
				</format>
        <args>
            <arg value="An fault error occurred" />
            <arg evaluator="xml" expression="$ctx:guid" />
            <arg evaluator="xml" expression="$ctx:appCalled" />
            <arg evaluator="xml" expression="$ctx:actionCalled" />
            <arg evaluator="xml" expression="replace($ctx:requestJson, '&quot;' , '\\&quot;')" />
            <arg evaluator="xml" expression="$ctx:exception" />
        </args>
    </payloadFactory>
    
	<property name="HTTP_SC" scope="axis2" type="STRING" value="500" />
	<property name="messageType" scope="axis2" type="STRING" value="application/json" />
	<property name="Access-Control-Allow-Origin" scope="transport" type="STRING" value="*" />
	<respond />
</sequence>