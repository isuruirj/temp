<?xml version="1.0" encoding="UTF-8"?>
<sequence name="BusinessProcessSendNotificationExternRejectedSeq" onError="FaultSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log level="custom" category="DEBUG">
        <property name="BusinessProcessSendNotificationExternRejectedSeq" value="Inicio.." />
    </log>
    <property name="uri.var.codigoSupervisor" expression="$ctx:data//bankCounterpart" />
    <!-- Consultar usuario supervisor -->
    <call>
        <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.enterpriseIntegratorHost}/api.centraid/identity/UserDataSimple/0/1?employeeCode={uri.var.codigoSupervisor}" />
    </call>
    <filter regex="200" source="get-property('axis2', 'HTTP_SC')">
        <then>
            <property name="supervisor" expression="$body//*" scope="default" type="OM" />
        </then>
        <else>
            <property name="fault" value="Error get supervisor" />
            <sequence key="FaultSeq" />
        </else>
    </filter>
    <!-- Consultar usuario solicitante -->
    <property name="uri.var.usernameCreation" expression="$ctx:data//usernameCreation" />
    <call>
        <endpoint template="HTTPEndpointGetTemplate" uri="{uri.var.enterpriseIntegratorHost}/api.centraid/identity/UserDataSimple/0/1?username={uri.var.usernameCreation}" />
    </call>
    <filter regex="200" source="get-property('axis2', 'HTTP_SC')">
        <then>
            <property name="solicitante" expression="$body//*" scope="default" type="OM" />
            <property name="toAddress" expression="$ctx:solicitante//mail" />
        </then>
        <else>
            <property name="fault" value="Error get solicitante" />
            <sequence key="FaultSeq" />
        </else>
    </filter>
    <payloadFactory media-type="json">
        <format>
            [
                {
                    "campo":"Generado",
                    "valor":"$1"
                
                },
                {
                    "campo":"nombreCompleto",
                    "valor":"$2"
                
                },
                {
                    "campo":"usuario",
                    "valor":"$3"
                
                },
                {
                    "campo":"tipoUsuario",
                    "valor":"$4"
                
                },
                {
                    "campo":"tipoIdentificacion",
                    "valor":"$5"
                
                },
                {
                    "campo":"identificacion",
                    "valor":"$6 "
                
                },
                {
                    "campo":"compania",
                    "valor":"$7 "
                
                },
                {
                    "campo":"division",
                    "valor":"$8 "
                
                },
                {
                    "campo":"area",
                    "valor":"$9 "
                
                },
                {
                    "campo":"departamento",
                    "valor":"$10 "
                
                },
                {
                    "campo":"cargo",
                    "valor":"$11 "
                
                },
                {
                    "campo":"centroCostos",
                    "valor":"$12 "
                
                },
                {
                    "campo":"responsable",
                    "valor":"$13 "
                
                },
                {
                    "campo":"usuarioSolicitante",
                    "valor":"$14 "
                },
                {
                    "campo":"observacion",
                    "valor":"$15 "
                }

            ]                      
            </format>
        <args>
            <arg evaluator="xml" expression="$ctx:currentDate" />
            <arg evaluator="xml" expression="$ctx:data//names" />
            <arg evaluator="xml" expression="$ctx:data//userTypeName" />
            <arg evaluator="xml" expression="$ctx:data//userSubtypeName" />
            <arg evaluator="xml" expression="$ctx:data//identityTypeName" />
            <arg evaluator="xml" expression="$ctx:data//identity" />
            <arg evaluator="xml" expression="$ctx:data//companyName" />
            <arg evaluator="xml" expression="$ctx:data//divisionName" />
            <arg evaluator="xml" value="" />
            <arg evaluator="xml" value="" />
            <arg evaluator="xml" expression="$ctx:data//positionName" />
            <arg evaluator="xml" expression="$ctx:data//costCenterName" />
            <arg evaluator="xml" expression="$ctx:supervisor//employeeCompleteName" />
            <arg evaluator="xml" expression="$ctx:solicitante//employeeCompleteName" />
            <arg evaluator="xml" expression="$ctx:data//justification" />
        </args>
    </payloadFactory>
    <log level="custom" category="DEBUG">
        <property name="BusinessProcessSendNotificationExternRejectedSeq" value="Fin.." />
    </log>
</sequence>