<?xml version="1.0" encoding="UTF-8"?>
<sequence name="BusinessLogicGetRolesSeq" onError="FaultSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse" xmlns:ns="http://org.apache.synapse/xsd">
    <log level="custom" category="DEBUG">
        <property name="BusinessLogicGetRolesSeq" value="Inicio..." />
    </log>
    <payloadFactory media-type="xml">
        <format>
            <xsd:getAllRolesNames xmlns:xsd="http://org.apache.axis2/xsd">
                <xsd:filter></xsd:filter>
                <xsd:limit>1000</xsd:limit>
            </xsd:getAllRolesNames>
        </format>
        <args />
    </payloadFactory>
    <property xmlns:ns2="http://org.apache.synapse/xsd" xmlns:ns="http://org.apache.synapse/xsd" name="IS_SERVER_USER_DATO" expression="synapse:get-property('IS_SERVER_USER')" scope="default" />
    <property xmlns:ns2="http://org.apache.synapse/xsd" xmlns:ns="http://org.apache.synapse/xsd" name="IS_SERVER_PASSWORD_DATO" expression="synapse:get-property('IS_SERVER_PASSWORD')" scope="default" />
    <property xmlns:ns="http://org.apache.synapse/xsd" name="Authorization" expression="fn:concat('Basic ', base64Encode(fn:concat($ctx:IS_SERVER_USER_DATO,':',$ctx:IS_SERVER_PASSWORD_DATO)))" scope="transport" />
    <property name="service_ep" expression="fn:concat(get-property('uri.var.identityServerHost'),'/services' ,'/UserAdmin')" />
    <header name="To" expression="get-property('service_ep')" />
    <property name="SOAPAction" value="getAllRolesNames" scope="transport" />
    <property name="REST_URL_POSTFIX" scope="axis2" action="remove" />
    <log level="custom" category="INFO" separator="**1**">
        <property name="service_ep" expression="get-property('service_ep')" />
    </log>
    <call>
        <endpoint>
            <default />
        </endpoint>
    </call>
    <log level="custom" category="INFO" separator="**2**" />
    <property name="fault" expression="//ns:UserStoreException" />
    <property name="fault2" expression="//faultstring" />
    <filter regex="true" source="boolean(get-property('fault')) or boolean(get-property('fault2'))">
        <then>
            <property name="fault" expression="fn:concat(get-property('fault'),':',get-property('fault2'))" />
            <sequence key="FaultSeq" />
        </then>
        <else>
            <log level="custom" category="INFO" separator="**5**" />
            <foreach  expression="//getAllRolesNamesResponse/return" xmlns:ns="http://org.apache.axis2/xsd">
                <sequence>
                    <payloadFactory media-type="xml">
                        <format>
                            <rol>
                                <name>$1</name>
                            </rol>
                        </format>
                        <args>
                            <arg evaluator="xml" expression="//*:itemName" />
                        </args>
                    </payloadFactory>
                </sequence>
            </foreach>
        </else>
    </filter>
    <property name="messageType" scope="axis2" value="application/json" />
    <property name="HTTP_SC" scope="axis2" type="STRING" value="200" />
    <log level="custom" category="DEBUG">
        <property name="BusinessLogicGetRolesSeq" value="Fin..." />
    </log>
</sequence>
