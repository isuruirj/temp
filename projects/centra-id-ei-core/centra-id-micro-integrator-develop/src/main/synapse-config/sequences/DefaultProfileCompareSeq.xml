<?xml version="1.0" encoding="UTF-8"?>
<sequence name="DefaultProfileCompareSeq" onError="FaultMassiveProcessUsersSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log level="custom" category="DEBUG">
        <property name="DefaultProfileCompareSeq" value="Inicio..." />
        <property name="uri.var.companyDefault" expression="get-property('uri.var.companyDefault')" />
        <property name="uri.var.divisionDefault" expression="get-property('uri.var.divisionDefault')" />
        <property name="uri.var.areaDefault" expression="get-property('uri.var.areaDefault')" />
        <property name="uri.var.departmentDefault" expression="get-property('uri.var.departmentDefault')" />
        <property name="uri.var.positionDefault" expression="get-property('uri.var.positionDefault')" />
    </log>
    <filter regex="true" source="boolean(get-property('uri.var.companyDefault'))">
        <then>
            <property action="set" name="uri.var.condition" expression="fn:concat('codeCompany=',get-property('uri.var.companyDefault'))" />
        </then>
    </filter>
    <filter regex="true" source="boolean(get-property('uri.var.positionDefault'))">
        <then>
            <property action="set" name="uri.var.condition" expression="fn:concat(get-property('uri.var.condition'),'&amp;','codePosition=',get-property('uri.var.positionDefault'))" />
        </then>
    </filter>
    <filter regex="true" source="boolean(get-property('uri.var.departmentDefault'))">
        <then>
            <property action="set" name="uri.var.condition" expression="fn:concat(get-property('uri.var.condition'),'&amp;','codeDepartment=',get-property('uri.var.departmentDefault'))" />
        </then>
    </filter>
    <filter regex="true" source="boolean(get-property('uri.var.areaDefault'))">
        <then>
            <property action="set" name="uri.var.condition" expression="fn:concat(get-property('uri.var.condition'),'&amp;','codeArea=',get-property('uri.var.areaDefault'))" />
        </then>
    </filter>
    <filter regex="true" source="boolean(get-property('uri.var.divisionDefault'))">
        <then>
            <property action="set" name="uri.var.condition" expression="fn:concat(get-property('uri.var.condition'),'&amp;','codeDivision=',get-property('uri.var.divisionDefault'))" />
        </then>
    </filter>
    <call>
        <endpoint name="Default_Endpoint" template="HTTPEndpointGetTemplate" uri="{uri.var.enterpriseIntegratorHost}/api.centraid/application/DefaultProfileSimple/0/10?{+uri.var.condition}" />
    </call>
    <filter regex="200" source="get-property('axis2', 'HTTP_SC')">
        <then>
            <filter regex="true" source="fn:count(//defaultProfileSimple)>0">
                <then>
                    <property name="result" value="1" />
                    <filter regex="true" source="fn:count(//defaultProfileSimple)=1">
                        <then>
                            <property name="profile" expression="(//defaultProfileSimple/globalProfileId)[1]" />
                        </then>
                        <else>
                            <property name="profileListDuplicate" value="" />
                            <!--
                            <iterate attachPath="//defaultProfileSimpleList" expression="//defaultProfileSimple" preservePayload="true" sequential="true">
                                <target>
                                    <sequence>
                                        <property name="globalProfileId" expression="//defaultProfileSimple/globalProfileId" />
                                        <call>
                                            <endpoint name="GlobalProfile_Endpoint" template="HTTPEndpointGetTemplate" uri="{uri.var.enterpriseIntegratorHost}/api.centraid/application/GlobalProfile/{uri.var.globalProfileId}" />
                                        </call>
                                    </sequence>
                                </target>
                            </iterate>
                            <property name="data" scope="default">
                                <data />
                            </property>
                            <aggregate>
                                <completeCondition>
                                    <messageCount min="-1" max="-1" />
                                </completeCondition>
                                <onComplete expression="$body/*[1]" enclosingElementProperty="data">
                                    <property name="profileListDuplicate" expression="fn:concat(get-property('profileListDuplicate'),':',//globalProfile/name)" />
                                </onComplete>
                            </aggregate>
                            -->
                        </else>
                    </filter>
                </then>
                <else>
                    <property name="result" value="-1" />
                </else>
            </filter>
        </then>
        <else>
            <sequence key="FaultMassiveProcessUsersSeq" />
        </else>
    </filter>
    <log level="custom" category="DEBUG">
        <property name="DefaultProfileCompareSeq" value="Fin..." />
        <property name="result" expression="get-property('result')" />
        <property name="profile" expression="get-property('profile')" />
        <property name="profileListDuplicate" expression="get-property('profileListDuplicate')" />
    </log>
</sequence>