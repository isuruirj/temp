<?xml version="1.0" encoding="UTF-8"?>
<template name="SendSmsSeqTemplate" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="templateType" />
    <parameter name="movil" />
    <parameter name="identification" />
    <parameter name="message" />
    <sequence>
        <log level="custom" category="DEBUG">
            <property name="status" value="Sending the sms now............." />
            <property name="templateType" expression="$func:templateType" />
            <property name="movil" expression="$func:movil" />
            <property name="identification" expression="$func:identification" />
            <property name="message" expression="$func:message" />
        </log>
        <property name="templateType" expression="$func:templateType" />
        <switch source="get-property('templateType')">
            <case regex="Plantilla_Sms_Operacion_Exito">
                <property name="subject" value="Reseteo de clave  exitoso" />
                <property name="transactionType" value="205006204" />
                <property name="notificationType" value="205006204SM" />
            </case>
            <case regex="Plantilla_Sms_Operacion_Error">
                <property name="subject" value="Intento de  Reseteo de Clave" />
                <property name="transactionType" value="205006204" />
                <property name="notificationType" value="205006204SM_ORD_1" />
            </case>
            <case regex="Plantilla_Sms_Clave_Exito">
                <property name="subject" value="Clave de acceso" />
                <property name="transactionType" value="205006205" />
                <property name="notificationType" value="205006205SM_ORD_0" />
            </case>
        </switch>
        <property name="AES_PAYLOAD" expression="$func:message" />
        <property name="AES_ACTION" scope="default" type="STRING" value="ENCRYPT" />
        <sequence key="EncryptDecryptSeq" />
        <xslt key="gov:/centra-id/xslt/sendNotificacionSmsToXml.xsl">
            <property name="transactionType" expression="get-property('transactionType')" />
            <property name="notificationType" expression="get-property('notificationType')" />
            <property name="identification" expression="$func:identification" />
            <property name="ip" expression="get-property('axis2','REMOTE_ADDR')" />
            <property name="message" expression="get-property('AES_RESULTS')" />
            <property name="movil" expression="$func:movil" />
        </xslt>
        <store description="SendNotificationSmsStore" messageStore="SendNotificationSmsStore" />
    </sequence>
</template>