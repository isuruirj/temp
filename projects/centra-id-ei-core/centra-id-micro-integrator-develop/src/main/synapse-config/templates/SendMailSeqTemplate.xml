<?xml version="1.0" encoding="UTF-8"?>
<template name="SendMailSeqTemplate" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="templateType" />
    <parameter name="toAddress" />
    <parameter name="identification" />
    <parameter name="message" />
    <parameter name="attachedName" />
    <parameter name="attachedBase64" />
    <parameter name="uuid" />
    <parameter name="guid" />
    <sequence>
        <log level="custom">
            <property name="status" value="Sending the mail now............." />
            <property name="templateType" expression="$func:templateType" />
            <property name="toAddress" expression="$func:toAddress" />
            <property name="identification" expression="$func:identification" />
            <property name="message" expression="$func:message" />
            <property name="attachedName" expression="$func:attachedName" />
            <property name="attachedBase64" expression="$func:attachedBase64" />
            <property name="uuid" expression="$func:uuid" />
            <property name="guid" expression="$func:guid" />
        </log>
        <property name="templateType" expression="$func:templateType" />
        <switch source="get-property('templateType')">
            <case regex="Plantilla_Email_GeneracionClaveInicial">
                <property name="subject" value="GENERACIÓN DE CLAVE INICIAL" />
                <property name="transactionType" value="205006002" />
                <property name="notificationType" value="205006002MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_PerfilGlobalAsignadoNoExiste">
                <property name="subject" value="PERFIL POR DEFECTO: NO EXISTE ASIGNADO UN PERFIL GLOBAL" />
                <property name="transactionType" value="205006003" />
                <property name="notificationType" value="205006003MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_PerfilGlobalAsignadoErrorCoincidencias">
                <property name="subject" value="PERFIL POR DEFECTO: EXISTE MAS DE UNA COINCIDENCIA" />
                <property name="transactionType" value="205006003" />
                <property name="notificationType" value="205006003MA_ORD_1" />
            </case>
            <case regex="Plantilla_Email_AprobacionCreacionUsuarioEmpleadoBPFilial">
                <property name="subject" value="APROBACIÓN DE SOLICITUD DE CREACIÓN DE USUARIO INTERNO" />
                <property name="transactionType" value="205006004" />
                <property name="notificationType" value="205006004MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_AprobacionCreacionUsuarioExterno">
                <property name="subject" value="APROBACIÓN DE SOLICITUD DE CREACIÓN DE USUARIO EXTERNO" />
                <property name="transactionType" value="205006005" />
                <property name="notificationType" value="205006005MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_AprobacionCreacionUsuarioGenericoRotativo">
                <property name="subject" value="APROBACIÓN DE SOLICITUD DE CREACIÓN DE USUARIO ROTATIVO" />
                <property name="transactionType" value="205006006" />
                <property name="notificationType" value="205006006MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_AprobacionSolicitudCreacionUsuario">
                <property name="subject" value="APROBACIÓN DE SOLICITUD DE CREACIÓN DE USUARIO GENÉRICO" />
                <property name="transactionType" value="205006007" />
                <property name="notificationType" value="205006007MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_RechazoAprobacionCreacionUsuarioEmpleadoBPFilial">
                <property name="subject" value="RECHAZO DE SOLICITUD DE CREACIÓN DE USUARIO INTERNO" />
                <property name="transactionType" value="205006008" />
                <property name="notificationType" value="205006008MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_RechazoAprobacionCreacionUsuarioExterno">
                <property name="subject" value="RECHAZO DE SOLICITUD DE CREACIÓN DE USUARIO EXTERNO" />
                <property name="transactionType" value="205006009" />
                <property name="notificationType" value="205006009MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_RechazoAprobacionCreacionUsuarioGenericoRotativo">
                <property name="subject" value="RECHAZO DE SOLICITUD DE CREACIÓN DE USUARIO ROTATIVO" />
                <property name="transactionType" value="205006102" />
                <property name="notificationType" value="205006102MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_RechazoAprobacionCreacionUsuarioGenerico">
                <property name="subject" value="RECHAZO DE SOLICITUD DE CREACIÓN DE USUARIO GENÉRICO" />
                <property name="transactionType" value="205006103" />
                <property name="notificationType" value="205006103MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_PerfilProximoVencer">
                <property name="subject" value="PERFIL PRÓXIMO A VENCER" />
                <property name="transactionType" value="205006104" />
                <property name="notificationType" value="205006104MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_CambiodePerfilporVencimiento">
                <property name="subject" value="CAMBIO DE PERFIL POR VENCIMIENTO" />
                <property name="transactionType" value="205006105" />
                <property name="notificationType" value="205006105MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_FechaVigenciaUsuarioPorVencer">
                <property name="subject" value="FECHA DE VIGENCIA DE USUARIO A VENCER" />
                <property name="transactionType" value="205006106" />
                <property name="notificationType" value="205006106MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_UsuarioDeshabilitadoPorVencimientoFechaVigencia">
                <property name="subject" value="USUARIO DESHABILITADOS POR VENCER PERIODO DE VIGENCIA" />
                <property name="transactionType" value="205006107" />
                <property name="notificationType" value="205006107MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_AprobacionSolicitudCreacionPerfilGlobal">
                <property name="subject" value="APROBACIÓN DE SOLICITUD DE CREACIÓN DE PERFIL GLOBAL" />
                <property name="transactionType" value="205006108" />
                <property name="notificationType" value="205006108MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_TicketRequerimientoAprovisionamiento">
                <property name="subject" value="REQUERIMIENTO APROVISIONAMIENTO - TICKET DE REQUERIMIENTO" />
                <property name="transactionType" value="205006109" />
                <property name="notificationType" value="205006109MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_TicketInsidente">
                <property name="subject" value="ERROR EN APROVISIONAMIENTO - TICKET DE INCIDENTE" />
                <property name="transactionType" value="205006202" />
                <property name="notificationType" value="205006202MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_ReseteoClavePortal_Exito">
                <property name="subject" value="RESETEO DE CLAVE  EXITOSO" />
                <property name="transactionType" value="205006203" />
                <property name="notificationType" value="205006203MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_ReseteoClavePortal_Error">
                <property name="subject" value="INTENTO DE  RESETEO DE CLAVE" />
                <property name="transactionType" value="205006203" />
                <property name="notificationType" value="205006203MA_ORD_1" />
            </case>
            <case regex="Plantilla_Email_SuscripcionUsuario_Exito">
                <property name="subject" value="SUSCRIPCIÓN DE USUARIO EN APP MÓVIL" />
                <property name="transactionType" value="205006206" />
                <property name="notificationType" value="205006206MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_SuscripcionUsuario_Error">
                <property name="subject" value="INTENTO DE SUSCRIPCIÓN DE USUARIO EN APP MÓVIL" />
                <property name="transactionType" value="205006206" />
                <property name="notificationType" value="205006206MA_ORD_1" />
            </case>
            <case regex="Plantilla_Email_ReseteoClaveApp_Exito">
                <property name="subject" value="RESETEO DE CLAVE EXITOSO POR APP MÓVIL" />
                <property name="transactionType" value="205006207" />
                <property name="notificationType" value="205006207MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_ReseteoClaveApp_Error">
                <property name="subject" value="INTENTO DE  RESETEO DE CLAVE SIN ÉXITO  POR APP MÓVIL" />
                <property name="transactionType" value="205006207" />
                <property name="notificationType" value="205006207MA_ORD_1" />
            </case>
            <case regex="Plantilla_Email_DesbloqueoUsuario_Exito">
                <property name="subject" value="DESBLOQUEO DE USUARIO EXITOSO POR APP MÓVIL" />
                <property name="transactionType" value="205006208" />
                <property name="notificationType" value="205006208MA_ORD_0" />
            </case>
            <case regex="Plantilla_Email_DesbloqueoUsuario_Error">
                <property name="subject" value="INTENTO DE DESBLOQUEO DE USUARIO SIN ÉXITO  POR APP MÓVIL" />
                <property name="transactionType" value="205006208" />
                <property name="notificationType" value="205006208MA_ORD_1" />
            </case>
            <case regex="Plantilla_Email_ListadoNovedades">
                <property name="subject" value="LISTADO DE NOVEDADES" />
                <property name="transactionType" value="205006209" />
                <property name="notificationType" value="205006209MA_ORD _0" />
            </case>
        </switch>
        <property name="AES_PAYLOAD" expression="$func:message" />
        <property name="AES_ACTION" scope="default" type="STRING" value="ENCRYPT" />
        <sequence key="EncryptDecryptSeq" />
        <log level="custom">
            <property name="SendMailSeqTemplate" value="Ver mensajes" />
            <property name="mensaje_claro" expression="get-property('$func:message')" />
            <property name="mensaje_encriptado" expression="get-property('AES_RESULTS')" />
        </log>
        
        <xslt key="gov:/centra-id/xslt/sendNotificacionMailToXml.xsl">
            <property name="subject" expression="get-property('subject')" />
            <property name="toAddress" expression="$func:toAddress" />
            <property name="transactionType" expression="get-property('transactionType')" />
            <property name="notificationType" expression="get-property('notificationType')" />
            <property name="identification" expression="$func:identification" />
            <property name="ip" expression="get-property('axis2','REMOTE_ADDR')" />
            <property name="message" expression="get-property('AES_RESULTS')" />
            <property name="attachedName" expression="$func:attachedName" />
            <property name="attachedBase64" expression="$func:attachedBase64" />
            <property name="uuid" expression="$func:uuid" />
            <property name="guid" expression="$func:guid" />
        </xslt>
        <store description="SendNotificationUserStore" messageStore="SendNotificationUserStore" />
    </sequence>
</template>